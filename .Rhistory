tables <- left_join(sections, table_ids) |>
group_by(section) |>
mutate(position = as.integer(position),
count = as.integer(count)) |>
fill(table) |>
select(rowid,
position,
count,
element,
table,
code,
label,
definition)
left_join(sections, table_ids) |>
group_by(section) |>
fill(table) |>
ungroup() |>
mutate(position = as.integer(position),
count = as.integer(count)) |>
select(rowid,
position,
count,
element,
table,
code,
label,
definition)
left_join(sections, table_ids) |>
group_by(section) |>
fill(table) |>
ungroup() |>
mutate(position = as.integer(position),
count = as.integer(count))
left_join(sections, table_ids) |>
group_by(section) |>
fill(table) |>
ungroup() |>
mutate(position = as.integer(position),
count = as.integer(count)) |>
select(rowid,
position,
section,
count,
element,
table,
code,
label,
definition)
left_join(sections, table_ids) |>
group_by(section) |>
fill(table) |>
ungroup() |>
mutate(position = as.integer(position),
count = as.integer(count)) |>
select(rowid,
position,
count,
element,
section,
table,
code,
label,
definition)
tables <- left_join(sections, table_ids) |>
group_by(section) |>
fill(table) |>
ungroup() |>
mutate(position = as.integer(position),
count = as.integer(count)) |>
select(rowid,
position,
count,
element,
section,
table,
code,
label,
definition)
tables
tables |>
filter(position == 4) |>
select(rowid, count, element, position, section, table, code, label) |>
mutate(start = rowid,
end = lead(start) - 1,
end = case_when(
start == max(start) ~ {
slice_tail(tables) |>
pull(rowid)
},
.default = end),
unit = row_number())
# Units ______________________________________________________________
unit_ivs <- tables |>
filter(position == 4) |>
select(rowid, count, element, position, section, table, code, label) |>
mutate(start = rowid,
end = lead(start) - 1,
end = case_when(
start == max(start) ~ {
slice_tail(tables) |>
pull(rowid)
},
.default = end),
unit = row_number())
left_join(tables, unit_ivs) |>
group_by(table) |>
fill(unit) |>
ungroup() |>
select(rowid,
count,
element,
position,
section,
table,
unit,
code,
label,
definition)
units <- left_join(tables, unit_ivs) |>
group_by(table) |>
fill(unit) |>
ungroup() |>
select(rowid,
count,
element,
position,
section,
table,
unit,
code,
label,
definition)
# Groups ______________________________________________________________
tbl_groupby <- units |>
group_by(section, table)
tbl_groupby
group_keys(tbl_groupby)
n_groups(tbl_groupby)
group_size(tbl_groupby)
head(group_split(tbl_groupby))
units
units |>
filter(position %in% c(1:3))
units |>
filter(position %in% c(1:3)) |>
pivot_wider(names_from = element, values_from = code)
units |>
filter(position %in% c(1:3)) |>
pivot_wider(names_from = element, values_from = c(code, label))
units |>
filter(position %in% c(1:3)) |>
pivot_wider(names_from = element, values_from = c(code, label, definition, position, section, table))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
position,
section,
table,
unit))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
rowid = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
position,
section,
table,
unit))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
position,
section,
table,
unit))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
position,
section,
table,
unit)) |>
janitor::remove_empty()
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols"))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols"))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_Section = lead(code_Section),
code_System = lead(code_System, 2),
code_Operation = lead(code_Operation, 3)
)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols"))
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2)
)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2)
)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
section,
table)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2)
) |>
glimpse()
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition,
table)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2)
)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2)
)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)
)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)) |>
filter(!is.na(code_Section))
# Groups ______________________________________________________________
tbl_groupby <- units |>
group_by(section, table)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)) |>
filter(!is.na(code_Section)) |>
rename(definition = definition_Operation)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)) |>
filter(!is.na(code_Section)) |>
rename(definition = definition_Operation,
sec_id = section,
tbl_id = table,
section = label_Section,
system = label_System,
operation = label_Operation) |>
unite('tbl_code', code_Section:code_Operation, na.rm = TRUE)
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)) |>
filter(!is.na(code_Section)) |>
rename(definition = definition_Operation,
sec_id = section,
tbl_id = table,
section = label_Section,
system = label_System,
operation = label_Operation) |>
unite('tbl_code', code_Section:code_Operation, na.rm = TRUE, sep = "")
units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)) |>
filter(!is.na(code_Section)) |>
rename(definition = definition_Operation,
sec_id = section,
tbl_id = table,
section = label_Section,
system = label_System,
operation = label_Operation) |>
unite('tbl_code', code_Section:code_Operation, na.rm = TRUE, sep = "") |>
mutate(rowid = NULL)
table_lookup <- units |>
filter(position %in% c(1:3)) |>
mutate(count = NULL,
position = NULL,
unit = NULL) |>
pivot_wider(names_from = element,
values_from = c(code,
label,
definition)) |>
janitor::remove_empty(which = c("rows", "cols")) |>
mutate(
code_System = lead(code_System, 1),
code_Operation = lead(code_Operation, 2),
label_System = lead(label_System, 1),
label_Operation = lead(label_Operation, 2),
definition_Operation = lead(definition_Operation, 2),
table = lead(table, 2)) |>
filter(!is.na(code_Section)) |>
rename(definition = definition_Operation,
sec_id = section,
tbl_id = table,
section = label_Section,
system = label_System,
operation = label_Operation) |>
unite('tbl_code', code_Section:code_Operation, na.rm = TRUE, sep = "") |>
mutate(rowid = NULL)
table_lookup
gc()
devtools::build_rmd("README.Rmd")
